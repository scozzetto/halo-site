<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HALO Terminal Claude - AI-Powered System Console</title>
    <meta name="description" content="HALO Terminal with Claude AI integration">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            background: #0a0a0a;
            color: #ffffff;
            overflow: hidden;
            height: 100vh;
        }
        
        /* Terminal Container */
        .terminal-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: #0a0a0a;
        }
        
        /* Terminal Header */
        .terminal-header {
            background: #1a1a1a;
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #333;
            user-select: none;
        }
        
        .terminal-controls {
            display: flex;
            gap: 0.5rem;
        }
        
        .terminal-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #444;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .terminal-button.close {
            background: #ff5f57;
        }
        
        .terminal-button.minimize {
            background: #ffbd2e;
        }
        
        .terminal-button.maximize {
            background: #28ca42;
        }
        
        .terminal-title {
            color: #888;
            font-size: 0.9rem;
            flex: 1;
            text-align: center;
        }
        
        .terminal-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .terminal-action {
            color: #888;
            text-decoration: none;
            font-size: 0.8rem;
            transition: color 0.2s;
        }
        
        .terminal-action:hover {
            color: #fff;
        }
        
        .api-status {
            font-size: 0.8rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            background: #1a1a1a;
            color: #28ca42;
        }
        
        .api-status.error {
            color: #ff5f57;
        }
        
        /* Terminal Body */
        .terminal-body {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            font-size: 14px;
            line-height: 1.5;
            background: #0a0a0a;
        }
        
        /* Terminal Output */
        .terminal-line {
            margin-bottom: 0.2rem;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .terminal-prompt {
            color: #8b5cf6;
            font-weight: bold;
        }
        
        .terminal-command {
            color: #ffffff;
        }
        
        .terminal-output {
            color: #c9c9d1;
        }
        
        .terminal-error {
            color: #ff5f57;
        }
        
        .terminal-success {
            color: #28ca42;
        }
        
        .terminal-warning {
            color: #ffbd2e;
        }
        
        .terminal-info {
            color: #5e9ef3;
        }
        
        /* Input Line */
        .terminal-input-line {
            display: flex;
            align-items: center;
            margin-top: 0.5rem;
        }
        
        .terminal-input-prompt {
            color: #8b5cf6;
            font-weight: bold;
            margin-right: 0.5rem;
            user-select: none;
        }
        
        .terminal-input {
            background: transparent;
            border: none;
            color: #ffffff;
            font-family: inherit;
            font-size: 14px;
            outline: none;
            flex: 1;
            caret-color: #8b5cf6;
        }
        
        /* Cursor */
        .cursor {
            display: inline-block;
            width: 8px;
            height: 16px;
            background: #8b5cf6;
            animation: blink 1s infinite;
            margin-left: 2px;
            vertical-align: text-bottom;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        /* ASCII Art */
        .ascii-art {
            color: #8b5cf6;
            font-size: 12px;
            line-height: 1.2;
            margin-bottom: 1rem;
        }
        
        /* AI Response */
        .ai-response {
            border-left: 3px solid #8b5cf6;
            padding-left: 1rem;
            margin: 0.5rem 0;
            color: #e0e0e0;
        }
        
        .ai-thinking {
            color: #8b5cf6;
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        
        /* Code Block */
        .code-block {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 0.5rem;
            margin: 0.5rem 0;
            font-family: 'SF Mono', monospace;
            font-size: 13px;
            overflow-x: auto;
        }
        
        /* Loading Dots */
        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite;
        }
        
        @keyframes dots {
            0% { content: ''; }
            25% { content: '.'; }
            50% { content: '..'; }
            75% { content: '...'; }
        }
        
        /* Scrollbar */
        .terminal-body::-webkit-scrollbar {
            width: 8px;
        }
        
        .terminal-body::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        .terminal-body::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }
        
        .terminal-body::-webkit-scrollbar-thumb:hover {
            background: #444;
        }
        
        /* Markdown Support */
        .markdown h1, .markdown h2, .markdown h3 {
            color: #8b5cf6;
            margin: 0.5rem 0;
        }
        
        .markdown h1 { font-size: 1.5rem; }
        .markdown h2 { font-size: 1.3rem; }
        .markdown h3 { font-size: 1.1rem; }
        
        .markdown ul, .markdown ol {
            margin-left: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        .markdown code {
            background: #2a2a2a;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            color: #50fa7b;
        }
        
        .markdown blockquote {
            border-left: 3px solid #6272a4;
            padding-left: 1rem;
            color: #6272a4;
            font-style: italic;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .terminal-body {
                font-size: 12px;
                padding: 0.5rem;
            }
            
            .terminal-input {
                font-size: 12px;
            }
        }
    </style>
    <script src="js/terminal-ai.js"></script>
</head>
<body>
    <div class="terminal-container">
        <div class="terminal-header">
            <div class="terminal-controls">
                <div class="terminal-button close" onclick="window.close()"></div>
                <div class="terminal-button minimize"></div>
                <div class="terminal-button maximize" onclick="toggleFullscreen()"></div>
            </div>
            <div class="terminal-title" id="terminalTitle">HALO Terminal Claude - AI-Powered Console</div>
            <div class="terminal-actions">
                <span class="api-status" id="apiStatus">No API Key</span>
                <a href="index.html" class="terminal-action">Exit</a>
            </div>
        </div>
        
        <div class="terminal-body" id="terminalBody">
            <!-- Terminal content will be added here -->
        </div>
    </div>

    <script>
        // Terminal State
        let commandHistory = [];
        let historyIndex = -1;
        let currentDirectory = '/halo';
        let isProcessing = false;
        let terminalAI = new TerminalAI();
        
        // Update API status
        function updateApiStatus() {
            const status = document.getElementById('apiStatus');
            if (terminalAI.apiKey) {
                status.textContent = 'Claude Connected';
                status.classList.remove('error');
            } else {
                status.textContent = 'No API Key';
                status.classList.add('error');
            }
        }
        
        // Commands
        const commands = {
            help: {
                description: 'Show available commands',
                execute: () => {
                    return `
HALO Terminal Claude - Command Reference

Claude AI Commands:
  claude <question>        - Ask Claude anything
  ai <question>           - Alias for claude
  ask <question>          - Another alias for claude
  
API Management:
  setkey <api-key>        - Set your Anthropic API key
  clearkey                - Clear stored API key
  
System Analysis:
  analyze <topic>         - Deep analysis with Claude
  explain <concept>       - Get explanations
  code <description>      - Generate code
  debug <issue>          - Debug problems
  
Be Well Commands:
  bewell                  - Ask about Be Well systems
  biosync                 - BioSync system info
  drbio                   - Dr. Bio chat info
  
Standard Commands:
  help                    - Show this help
  clear                   - Clear terminal
  history                 - Command history
  
Examples:
  claude how does the biosync AI work?
  analyze patient check-in system
  code create a netlify function
  bewell what databases are used?
  
Note: You need to set your Anthropic API key first:
  setkey sk-ant-api03-xxxxx...xxxxx`;
                }
            },
            
            claude: {
                description: 'Ask Claude a question',
                execute: async (args) => {
                    if (!args.length) {
                        return 'Usage: claude <your question>';
                    }
                    
                    const question = args.join(' ');
                    addOutput('🤖 Claude is thinking...', 'ai-thinking');
                    
                    const response = await terminalAI.askClaude(question);
                    
                    // Remove the thinking message
                    const terminalBody = document.getElementById('terminalBody');
                    const thinkingMsg = terminalBody.querySelector('.ai-thinking').parentElement;
                    thinkingMsg.remove();
                    
                    if (response.error) {
                        return `Error: ${response.message}`;
                    }
                    
                    return `<div class="ai-response">${formatAIResponse(response.message)}</div>`;
                }
            },
            
            ai: {
                description: 'Alias for claude',
                execute: (args) => commands.claude.execute(args)
            },
            
            ask: {
                description: 'Another alias for claude',
                execute: (args) => commands.claude.execute(args)
            },
            
            setkey: {
                description: 'Set Anthropic API key',
                execute: (args) => {
                    if (!args[0]) {
                        return 'Usage: setkey <your-api-key>';
                    }
                    
                    const result = terminalAI.setApiKey(args[0]);
                    updateApiStatus();
                    return result;
                }
            },
            
            clearkey: {
                description: 'Clear API key',
                execute: () => {
                    const result = terminalAI.clearApiKey();
                    updateApiStatus();
                    return result;
                }
            },
            
            analyze: {
                description: 'Deep analysis with Claude',
                execute: async (args) => {
                    if (!args.length) {
                        return 'Usage: analyze <topic>';
                    }
                    
                    const topic = args.join(' ');
                    const question = `Please provide a detailed analysis of: ${topic}. Include technical details, architecture, implementation, and any relevant code examples.`;
                    
                    return await commands.claude.execute(question.split(' '));
                }
            },
            
            explain: {
                description: 'Get explanations',
                execute: async (args) => {
                    if (!args.length) {
                        return 'Usage: explain <concept>';
                    }
                    
                    const concept = args.join(' ');
                    const question = `Please explain ${concept} in simple terms, then provide technical details and examples.`;
                    
                    return await commands.claude.execute(question.split(' '));
                }
            },
            
            code: {
                description: 'Generate code',
                execute: async (args) => {
                    if (!args.length) {
                        return 'Usage: code <description>';
                    }
                    
                    const description = args.join(' ');
                    const question = `Please generate code for: ${description}. Include comments and best practices.`;
                    
                    return await commands.claude.execute(question.split(' '));
                }
            },
            
            debug: {
                description: 'Debug problems',
                execute: async (args) => {
                    if (!args.length) {
                        return 'Usage: debug <issue>';
                    }
                    
                    const issue = args.join(' ');
                    const question = `Help me debug this issue: ${issue}. Provide potential causes and solutions.`;
                    
                    return await commands.claude.execute(question.split(' '));
                }
            },
            
            bewell: {
                description: 'Be Well system info',
                execute: async (args) => {
                    const query = args.length 
                        ? `Tell me about the Be Well LifeStyle Centers ${args.join(' ')}`
                        : 'Give me an overview of the Be Well LifeStyle Centers system architecture';
                    
                    return await commands.claude.execute(query.split(' '));
                }
            },
            
            biosync: {
                description: 'BioSync info',
                execute: async (args) => {
                    const query = args.length
                        ? `Explain the BioSync ${args.join(' ')}`
                        : 'Explain how the BioSync health assessment system works';
                    
                    return await commands.claude.execute(query.split(' '));
                }
            },
            
            drbio: {
                description: 'Dr. Bio info',
                execute: async (args) => {
                    const query = args.length
                        ? `Tell me about Dr. Bio ${args.join(' ')}`
                        : 'Explain the Dr. Bio AI chat assistant and how it analyzes lab results';
                    
                    return await commands.claude.execute(query.split(' '));
                }
            },
            
            clear: {
                description: 'Clear terminal',
                execute: () => {
                    document.getElementById('terminalBody').innerHTML = '';
                    return null;
                }
            },
            
            history: {
                description: 'Show command history',
                execute: () => {
                    if (commandHistory.length === 0) {
                        return 'No command history yet.';
                    }
                    return commandHistory.map((cmd, i) => `  ${i + 1}  ${cmd}`).join('\n');
                }
            }
        };
        
        // Format AI response with basic markdown support
        function formatAIResponse(text) {
            // Basic markdown to HTML
            return text
                .replace(/```([^`]+)```/g, '<div class="code-block">$1</div>')
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
                .replace(/\*([^*]+)\*/g, '<em>$1</em>')
                .replace(/^### (.+)$/gm, '<h3>$1</h3>')
                .replace(/^## (.+)$/gm, '<h2>$1</h2>')
                .replace(/^# (.+)$/gm, '<h1>$1</h1>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/^/, '<p>')
                .replace(/$/, '</p>');
        }
        
        // Initialize Terminal
        function initTerminal() {
            const asciiArt = `
<span class="ascii-art">
  _____ _                 _      
 / ____| |               | |     
| |    | | __ _ _   _  __| | ___ 
| |    | |/ _\` | | | |/ _\` |/ _ \\
| |____| | (_| | |_| | (_| |  __/
 \\_____|_|\\__,_|\\__,_|\\__,_|\\___|
                                  
HALO Terminal Claude v1.0 - AI-Powered System Console
</span>`;
            
            addRawOutput(asciiArt);
            addOutput('Welcome to HALO Terminal with Claude AI Integration', 'success');
            addOutput('Direct access to Claude for system analysis and assistance', 'info');
            
            if (!terminalAI.apiKey) {
                addOutput('\n⚠️  No API key detected. Set your Anthropic API key:', 'warning');
                addOutput('  setkey sk-ant-api03-xxxxx...xxxxx', 'info');
                addOutput('  Get your key at: https://console.anthropic.com/settings/keys\n', 'info');
            } else {
                addOutput('✅ Claude AI is connected and ready\n', 'success');
            }
            
            addOutput('Type "help" for available commands\n');
            updateApiStatus();
            addInputLine();
        }
        
        // Add output to terminal
        function addOutput(text, className = 'terminal-output') {
            const terminalBody = document.getElementById('terminalBody');
            const line = document.createElement('div');
            line.className = 'terminal-line';
            const span = document.createElement('span');
            span.className = className;
            span.textContent = text;
            line.appendChild(span);
            terminalBody.appendChild(line);
            scrollToBottom();
        }
        
        // Add raw HTML output
        function addRawOutput(html) {
            const terminalBody = document.getElementById('terminalBody');
            const line = document.createElement('div');
            line.className = 'terminal-line';
            line.innerHTML = html;
            terminalBody.appendChild(line);
            scrollToBottom();
        }
        
        // Add command line
        function addCommandLine(command) {
            const terminalBody = document.getElementById('terminalBody');
            const line = document.createElement('div');
            line.className = 'terminal-line';
            line.innerHTML = `<span class="terminal-prompt">${currentDirectory}$</span> <span class="terminal-command">${escapeHtml(command)}</span>`;
            terminalBody.appendChild(line);
            scrollToBottom();
        }
        
        // Add input line
        function addInputLine() {
            if (isProcessing) return;
            
            const terminalBody = document.getElementById('terminalBody');
            const inputLine = document.createElement('div');
            inputLine.className = 'terminal-input-line';
            inputLine.innerHTML = `
                <span class="terminal-input-prompt">${currentDirectory}$</span>
                <input type="text" class="terminal-input" id="terminalInput" autocomplete="off" spellcheck="false">
                <span class="cursor" id="cursor"></span>
            `;
            terminalBody.appendChild(inputLine);
            
            const input = document.getElementById('terminalInput');
            input.focus();
            
            input.addEventListener('keydown', handleKeyDown);
            scrollToBottom();
        }
        
        // Handle keyboard input
        function handleKeyDown(e) {
            const input = e.target;
            
            switch(e.key) {
                case 'Enter':
                    e.preventDefault();
                    processCommand(input.value);
                    break;
                    
                case 'ArrowUp':
                    e.preventDefault();
                    if (historyIndex < commandHistory.length - 1) {
                        historyIndex++;
                        input.value = commandHistory[commandHistory.length - 1 - historyIndex];
                    }
                    break;
                    
                case 'ArrowDown':
                    e.preventDefault();
                    if (historyIndex > 0) {
                        historyIndex--;
                        input.value = commandHistory[commandHistory.length - 1 - historyIndex];
                    } else if (historyIndex === 0) {
                        historyIndex = -1;
                        input.value = '';
                    }
                    break;
                    
                case 'Tab':
                    e.preventDefault();
                    autocomplete(input);
                    break;
                    
                case 'l':
                    if (e.ctrlKey) {
                        e.preventDefault();
                        commands.clear.execute();
                        addInputLine();
                    }
                    break;
            }
        }
        
        // Process command
        async function processCommand(commandText) {
            if (isProcessing) return;
            isProcessing = true;
            
            const input = document.getElementById('terminalInput');
            const inputLine = input.parentElement;
            inputLine.removeChild(input);
            inputLine.removeChild(document.getElementById('cursor'));
            
            addCommandLine(commandText);
            
            if (commandText.trim()) {
                commandHistory.push(commandText);
                historyIndex = -1;
                
                const [cmd, ...args] = commandText.trim().split(' ');
                
                if (commands[cmd]) {
                    try {
                        const result = await commands[cmd].execute(args);
                        if (result !== null && result !== undefined) {
                            if (result) {
                                if (result.includes('<div') || result.includes('<span')) {
                                    addRawOutput(result);
                                } else {
                                    addOutput(result);
                                }
                            }
                        }
                    } catch (error) {
                        addOutput(`Error: ${error.message}`, 'terminal-error');
                    }
                } else if (commandText.trim()) {
                    // If command not found, try to ask Claude about it
                    addOutput(`Command not found: ${cmd}`, 'terminal-error');
                    addOutput(`Try: claude ${commandText}`, 'terminal-info');
                }
            }
            
            isProcessing = false;
            addInputLine();
        }
        
        // Autocomplete
        function autocomplete(input) {
            const value = input.value.toLowerCase();
            const allCommands = Object.keys(commands);
            const matches = allCommands.filter(cmd => cmd.startsWith(value));
            
            if (matches.length === 1) {
                input.value = matches[0];
            } else if (matches.length > 1) {
                addOutput(`\nPossible commands: ${matches.join(', ')}`);
                addInputLine();
                document.getElementById('terminalInput').value = value;
            }
        }
        
        // Utility functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function scrollToBottom() {
            const terminalBody = document.getElementById('terminalBody');
            terminalBody.scrollTop = terminalBody.scrollHeight;
        }
        
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }
        
        // Initialize on load
        window.addEventListener('DOMContentLoaded', initTerminal);
    </script>
</body>
</html>